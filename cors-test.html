<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS Test - N3RVE Platform</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow: auto; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .container { max-width: 800px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #dee2e6; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ CORS Testing for N3RVE Platform</h1>
        <p>This page tests CORS functionality between frontend (localhost:3000) and backend (localhost:3001).</p>
        
        <div class="test-section">
            <h2>Test 1: Saved Artists API (GET)</h2>
            <button onclick="testSavedArtists()">Test /api/saved-artists/artists</button>
            <div id="saved-artists-result"></div>
        </div>

        <div class="test-section">
            <h2>Test 2: Health Check (GET)</h2>
            <button onclick="testHealthCheck()">Test /api/health</button>
            <div id="health-result"></div>
        </div>

        <div class="test-section">
            <h2>Test 3: Auth Profile (GET - Should fail with 401)</h2>
            <button onclick="testAuthProfile()">Test /api/auth/me</button>
            <div id="auth-result"></div>
        </div>

        <div class="test-section">
            <h2>Console Log</h2>
            <pre id="console-log"></pre>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        let logOutput = '';

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            const colorClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logOutput += `[${timestamp}] ${message}\n`;
            document.getElementById('console-log').innerHTML = logOutput;
            console.log(message);
        }

        function displayResult(elementId, success, data, error = null) {
            const element = document.getElementById(elementId);
            if (success) {
                element.innerHTML = `
                    <div class="success">‚úÖ SUCCESS: CORS working properly!</div>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } else {
                if (error && error.toString().includes('CORS')) {
                    element.innerHTML = `<div class="error">‚ùå CORS ERROR: ${error}</div>`;
                } else {
                    element.innerHTML = `
                        <div class="info">‚ÑπÔ∏è CORS OK, Expected Error: ${error || 'Authentication required'}</div>
                        <pre>${data ? JSON.stringify(data, null, 2) : 'No response data'}</pre>
                    `;
                }
            }
        }

        async function testSavedArtists() {
            log('Testing /api/saved-artists/artists...');
            try {
                const response = await fetch(`${API_BASE}/saved-artists/artists`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (response.status === 401) {
                    log('‚úÖ CORS Success: Got expected 401 Unauthorized', 'success');
                    displayResult('saved-artists-result', true, data);
                } else if (response.ok) {
                    log('‚úÖ CORS Success: Got valid response', 'success');
                    displayResult('saved-artists-result', true, data);
                } else {
                    log(`‚ùì Unexpected status: ${response.status}`, 'info');
                    displayResult('saved-artists-result', false, data, `HTTP ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå Request failed: ${error.message}`, 'error');
                displayResult('saved-artists-result', false, null, error.message);
            }
        }

        async function testHealthCheck() {
            log('Testing /api/health...');
            try {
                const response = await fetch(`${API_BASE}/health`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    log('‚úÖ CORS Success: Health check passed', 'success');
                    displayResult('health-result', true, data);
                } else {
                    log(`‚ùì Health check failed: ${response.status}`, 'info');
                    displayResult('health-result', false, data, `HTTP ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå Health check error: ${error.message}`, 'error');
                displayResult('health-result', false, null, error.message);
            }
        }

        async function testAuthProfile() {
            log('Testing /api/auth/me (should return 401)...');
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (response.status === 401) {
                    log('‚úÖ CORS Success: Got expected 401 Unauthorized', 'success');
                    displayResult('auth-result', true, data);
                } else if (response.ok) {
                    log('‚úÖ CORS Success: Unexpectedly got valid auth response', 'success');
                    displayResult('auth-result', true, data);
                } else {
                    log(`‚ùì Unexpected auth status: ${response.status}`, 'info');
                    displayResult('auth-result', false, data, `HTTP ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå Auth request failed: ${error.message}`, 'error');
                displayResult('auth-result', false, null, error.message);
            }
        }

        // Log initial page load
        log('üß™ CORS Test Page Loaded');
        log('üìç Frontend Origin: ' + window.location.origin);
        log('üéØ Backend Target: ' + API_BASE);
        log('');
        log('Click the buttons above to test CORS functionality...');
    </script>
</body>
</html>