<!DOCTYPE html>
<html>
<head>
    <title>CORS Test</title>
</head>
<body>
    <h1>CORS Test for N3RVE Platform</h1>
    <button id="testSavedArtists">Test Saved Artists API</button>
    <button id="testWithAuth">Test with Auth Header</button>
    <div id="results"></div>

    <script>
        const resultsDiv = document.getElementById('results');

        function logResult(message, data = null) {
            console.log(message, data);
            const div = document.createElement('div');
            div.style.margin = '10px 0';
            div.style.padding = '10px';
            div.style.border = '1px solid #ccc';
            div.innerHTML = `<strong>${message}</strong><br><pre>${JSON.stringify(data, null, 2)}</pre>`;
            resultsDiv.appendChild(div);
        }

        document.getElementById('testSavedArtists').addEventListener('click', async () => {
            logResult('Testing basic saved artists request...');
            
            try {
                const response = await fetch('http://localhost:3001/api/saved-artists/artists', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'include'
                });
                
                logResult('Response Status:', response.status);
                logResult('Response Headers:', Object.fromEntries(response.headers.entries()));
                
                const data = await response.text();
                logResult('Response Data:', data);
                
            } catch (error) {
                logResult('Fetch Error:', {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                });
            }
        });

        document.getElementById('testWithAuth').addEventListener('click', async () => {
            logResult('Testing with authorization header...');
            
            try {
                const response = await fetch('http://localhost:3001/api/saved-artists/artists', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': 'Bearer fake-token-for-testing'
                    },
                    credentials: 'include'
                });
                
                logResult('Response Status:', response.status);
                logResult('Response Headers:', Object.fromEntries(response.headers.entries()));
                
                const data = await response.text();
                logResult('Response Data:', data);
                
            } catch (error) {
                logResult('Fetch Error:', {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                });
            }
        });

        // Test preflight requests
        logResult('Testing preflight request for POST...');
        fetch('http://localhost:3001/api/saved-artists/artists', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            credentials: 'include',
            body: JSON.stringify({test: 'data'})
        }).then(response => {
            logResult('POST Response Status:', response.status);
            logResult('POST Response Headers:', Object.fromEntries(response.headers.entries()));
            return response.text();
        }).then(data => {
            logResult('POST Response Data:', data);
        }).catch(error => {
            logResult('POST Fetch Error:', {
                name: error.name,
                message: error.message,
                stack: error.stack
            });
        });
    </script>
</body>
</html>